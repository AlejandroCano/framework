<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<Target Name="GenerateSignumTS">
		<WriteLinesToFile File="$(BaseIntermediateOutputPath)SignumReferences.txt" Lines="@(ReferencePath)" Overwrite="true" Encoding="Unicode" />
		<Exec command="dotnet &quot;$(MSBuildThisFileDirectory)Signum.TSGenerator.dll&quot; &quot;@(IntermediateAssembly)&quot; &quot;$(BaseIntermediateOutputPath)SignumReferences.txt&quot; &quot;$(BaseIntermediateOutputPath)SignumContent.txt&quot;" ConsoleToMSBuild="true">
			<Output TaskParameter="ConsoleOutput" PropertyName="OutputOfExec" />
		</Exec>
	</Target>
	<PropertyGroup>
		<CompileTypeScriptDependsOn>
			GenerateSignumTS;
			StartTypescript;
			$(CompileTypeScriptDependsOn);
		</CompileTypeScriptDependsOn>
		<CompileDependsOn>
			$([MSBuild]::Unescape($(CompileDependsOn.Replace("CompileTypeScriptWithTSConfig;", ""))))
		</CompileDependsOn>
		<BuildDependsOn>
			MyCustomTarget;
			$(BuildDependsOn);
			CompileTypeScriptWithTSConfig;
			EndTypescript;
		</BuildDependsOn>
	</PropertyGroup> 
	<Target Name="MyCustomTarget">
	    <!-- <Message Text="BEFORE $(CompileDependsOn)" Importance="high" /> -->
	    <PropertyGroup>
			<CompileDependsOn>
				$([MSBuild]::Unescape($(CompileDependsOn.Replace("CompileTypeScriptWithTSConfig;", ""))))
			</CompileDependsOn>
		</PropertyGroup>
		<!-- <Message Text="AFTER $(CompileDependsOn)" Importance="high" /> -->
	</Target>
	<Target Name="StartTypescript" Condition="'$(TypeScriptCompileBlocked)' == 'false'">
		<Message Text="TypeScript Compiler Starting" Importance="high" />
	</Target>
	<Target Name="EndTypescript" Condition="'$(TypeScriptCompileBlocked)' == 'false'">
		<Message Text="TypeScript Compiler Finished" Importance="high" />
	</Target>
</Project>
